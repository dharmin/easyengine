# PHP NGINX CONFIGURATION
# DO NOT MODIFY, ALL CHANGES LOST AFTER UPDATE EasyEngine (ee)
location / {
  try_files $uri $uri/ /index.php?$args;
}
# location ~ \.php$ {
#   try_files $uri =404;
#   fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
#   include fastcgi_params;
#   fastcgi_pass php:9000;
# }


location ~ \.php$ {
    set $key "nginx-cache:$scheme$request_method$host$request_uri";
    try_files $uri =404;

    srcache_fetch_skip $skip_cache;
    srcache_store_skip $skip_cache;

    srcache_response_cache_control off;

    set_escape_uri $escaped_key $key;

    srcache_fetch GET /redis-fetch $key;
    srcache_store PUT /redis-store key=$escaped_key;

    more_set_headers 'X-Cache-Fetch $srcache_fetch_status';
    more_set_headers 'X-Cache-Store $srcache_store_status';
    more_set_headers 'X-Cache-Key $key';

    include fastcgi_params;
    fastcgi_pass php:9000;
}